<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teste Backend - Pet Shop</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container my-5">
    <h1 class="mb-4">üß™ Teste de Conectividade Backend</h1>
    
    <div class="row g-3">
      <div class="col-md-6">
        <div class="card">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">1. Testar Categorias</h5>
          </div>
          <div class="card-body">
            <button onclick="testarCategorias()" class="btn btn-primary w-100">
              Buscar Categorias
            </button>
            <div id="resultCategorias" class="mt-3"></div>
          </div>
        </div>
      </div>
      
      <div class="col-md-6">
        <div class="card">
          <div class="card-header bg-success text-white">
            <h5 class="mb-0">2. Testar Produtos</h5>
          </div>
          <div class="card-body">
            <button onclick="testarProdutos()" class="btn btn-success w-100">
              Buscar Produtos
            </button>
            <div id="resultProdutos" class="mt-3"></div>
          </div>
        </div>
      </div>
      
      <div class="col-12">
        <div class="card">
          <div class="card-header bg-warning">
            <h5 class="mb-0">3. Testar Cadastro de Cliente</h5>
          </div>
          <div class="card-body">
            <button onclick="testarCadastro()" class="btn btn-warning w-100">
              Cadastrar Cliente de Teste
            </button>
            <div id="resultCadastro" class="mt-3"></div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="card mt-4">
      <div class="card-header bg-info text-white">
        <h5 class="mb-0">üìã Console de Logs</h5>
      </div>
      <div class="card-body">
        <div id="console" class="bg-dark text-white p-3 rounded" style="max-height: 400px; overflow-y: auto; font-family: monospace; font-size: 12px;">
          Aguardando testes...
        </div>
      </div>
    </div>
  </div>

  <script src="js/api-config.js"></script>
  <script>
    // Override console.log para mostrar na p√°gina
    const consoleDiv = document.getElementById('console');
    const originalLog = console.log;
    console.log = function(...args) {
      originalLog.apply(console, args);
      const msg = args.map(arg => 
        typeof arg === 'object' ? JSON.stringify(arg, null, 2) : arg
      ).join(' ');
      consoleDiv.innerHTML += msg + '\n';
      consoleDiv.scrollTop = consoleDiv.scrollHeight;
    };
    
    const originalError = console.error;
    console.error = function(...args) {
      originalError.apply(console, args);
      const msg = args.map(arg => 
        typeof arg === 'object' ? JSON.stringify(arg, null, 2) : arg
      ).join(' ');
      consoleDiv.innerHTML += '<span style="color: #ff6b6b;">‚ùå ' + msg + '</span>\n';
      consoleDiv.scrollTop = consoleDiv.scrollHeight;
    };
    
    async function testarCategorias() {
      const result = document.getElementById('resultCategorias');
      result.innerHTML = '<div class="spinner-border spinner-border-sm"></div> Carregando...';
      
      try {
        console.log('üß™ Testando GET /api/categorias/ativas');
        const categorias = await ApiService.get(API_CONFIG.ENDPOINTS.CATEGORIAS_ATIVAS);
        
        result.innerHTML = `
          <div class="alert alert-success">
            ‚úÖ Sucesso! ${categorias.length} categorias encontradas
          </div>
          <pre class="bg-light p-2 rounded" style="max-height: 200px; overflow-y: auto;">${JSON.stringify(categorias, null, 2)}</pre>
        `;
      } catch (error) {
        result.innerHTML = `
          <div class="alert alert-danger">
            ‚ùå Erro: ${error.message}
          </div>
        `;
      }
    }
    
    async function testarProdutos() {
      const result = document.getElementById('resultProdutos');
      result.innerHTML = '<div class="spinner-border spinner-border-sm"></div> Carregando...';
      
      try {
        console.log('üß™ Testando GET /api/produtos/disponiveis');
        const produtos = await ApiService.get(API_CONFIG.ENDPOINTS.PRODUTOS_DISPONIVEIS);
        
        result.innerHTML = `
          <div class="alert alert-success">
            ‚úÖ Sucesso! ${produtos.length} produtos encontrados
          </div>
          <pre class="bg-light p-2 rounded" style="max-height: 200px; overflow-y: auto;">${JSON.stringify(produtos, null, 2)}</pre>
        `;
      } catch (error) {
        result.innerHTML = `
          <div class="alert alert-danger">
            ‚ùå Erro: ${error.message}
          </div>
        `;
      }
    }
    
    async function testarCadastro() {
      const result = document.getElementById('resultCadastro');
      result.innerHTML = '<div class="spinner-border spinner-border-sm"></div> Cadastrando...';
      
      try {
        const timestamp = Date.now();
        const clienteData = {
          nome: "Cliente Teste " + timestamp,
          cpf: "12345678" + String(timestamp).slice(-3),
          email: "teste" + timestamp + "@email.com",
          telefone: "11987654321",
          dataNascimento: "1990-01-01",
          sexo: "M",
          endereco: "Rua Teste",
          numero: "123",
          bairro: "Centro",
          cidade: "S√£o Paulo"
        };
        
        console.log('üß™ Testando POST /api/clientes');
        console.log('Dados:', clienteData);
        
        const cliente = await ApiService.post(API_CONFIG.ENDPOINTS.CLIENTES, clienteData);
        
        result.innerHTML = `
          <div class="alert alert-success">
            ‚úÖ Cliente cadastrado com sucesso!
          </div>
          <pre class="bg-light p-2 rounded" style="max-height: 200px; overflow-y: auto;">${JSON.stringify(cliente, null, 2)}</pre>
        `;
      } catch (error) {
        result.innerHTML = `
          <div class="alert alert-danger">
            ‚ùå Erro: ${error.message}
            <br><small>${error.data ? JSON.stringify(error.data) : ''}</small>
          </div>
        `;
      }
    }
    
    console.log('‚úÖ P√°gina de testes carregada!');
    console.log('Backend URL:', API_CONFIG.BASE_URL);
  </script>
</body>
</html>
